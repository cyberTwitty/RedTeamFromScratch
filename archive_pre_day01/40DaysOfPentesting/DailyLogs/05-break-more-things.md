# 🛠️ Day #5 – From Source Code to System Confusion 💥💻

## 🎯 Overall Goal

Day 5 ended up pivoting from structured input testing into hands-on source code analysis and a **very** impromptu troubleshooting deep dive. This was my original goal for the day:  

> Master UNION-based SQL injection by dumping real data from the DVWA target, practicing controlled payload testing in Burp Suite, and documenting the full attack flow with clean, redacted screenshots.

So the intent was to enumerate columns and extract user data via SQL injection (SQLi), but shifting behavior in DVWA's security level revealed unexpected misconfigurations -- which required some serious sleuthing. Before I knew it, the day was over and I still hadn't solved the issue. C'est la vie!

#### (Screenshots for the day can be seen [here](../Screenshots/Day5.md). Judge away, oh mighty Judgers! )

## 🧱 Block 1: Source Code Review - Understanding How DVWA Processes Input

### 🎯 Block 1 Goal  

To get a deeper understanding of how DVWA is processing form input under the hood, using its built-in "View Source" feature on the lower right-hand side of the page. Gain macro-level insight into the SQL query, filters, and security mechanisms in place on this site. 

✅ Subtasks:

- [x] Review PHP logic for unput handling and SQL query construction
- [x] Identify protections and checks in place like `mysql_real_escape_string()` and `is_numeric()`


### 🔧 Setup Notes

- Burp suite is connected, and I learned about "Burp-Browser Flow". ![Burp to Browser OOP](/40DaysOfPentesting/Screenshots/raw-images/burp-flow.png 'Burp Order of Operations')
- DVWA is in `low` security mode (or so I thought)
- Intercept is `off` for now, will toggle `on` when ready to modify requests

### 🧠 Observations & Troubleshooting

- I realized DVWA is querying from a table called `users`. I was able to confirm that `id` is being sanitized, albeit weakly.
- I saw how the SQL query is structured: `SELECT first_name, last_name FROM users WHERE user_id='$id'`  

### 📥 Block 1 Takeaway

- Having the source code so readily available was a gift, I know, but getting that peek behind the curtain helped me better identify what *kind* of injection the app is vulnerable to, and why. This kind of inspection makes exploitation more strategic and less guesswork. Plus, it lets me flex those old programming muscles!  
  
---

## 🧱 Block 2: SQLi Column Enumeration - Working Smarter, Until I Wasn't

### 🎯 Block 2 Goal

Leverage insights from the source code to craft smarter SQL injection payloads and identify how many columns the target query returns. 

✅ Subtasks:

- [x] Try using test payload: `' UNION SELECT null, version(), user() #` to find out just how many columns are available. 
- [x] Try testing with `ORDER BY` in Burp Suite's Intruder tab to count columns
- [x] Screenshot relevant takeaways  

### 🧠 Block 2 Observations

- The `UNION SELECT` statement led to a "column mismatch" error that eventually led to the rabbit hole I fell into. I tried the `ORDER BY` option in Intruder to see if that would help me enumerate more efficiently. It did, but even though I iterated through 10+ columns, the results I got weren't helpful.  
- Response lengths were mostly static (4683/4684), which didn’t help narrow it down
- Confusion grew as it felt like something else was wrong — results weren’t consistent with what *should* be considered “low” security precautions on DVWA's site.  

### 📥 Block 2 Takeaway(s)

Sometimes your payload isn’t broken — your environment is. This block taught me a crucial lesson in red teaming: never assume your testbed is behaving because you configured everything perfectly the first time around. Here’s how that unfolded:

I was running SQLi tests that should’ve worked on DVWA in `low` security, but the results were inconsistent — requests that should have returned dumpable column names or user data were either throwing errors or producing nothing useful. At first, I thought the issue was with my payloads, syntax, or logic. But after exhausting multiple known, good techniques, I started looking outward.

In Burp Suite, I confirmed that my requests did include the `security=low` cookie — so at first glance, everything should have worked. But in the DVWA web UI, I noticed the security level dropdown kept snapping back to `high` every time I navigated between pages. That’s when the red flag (finally) went up.

So I started digging:

- Tried manually editing cookies → still no change

- Tried modifying the DVWA config file to force low on load → but the config file didn’t exist

- Checked the web root in Metasploitable → the dvwa folder wasn’t there

- Confirmed port 80 was open on 192.168.77.20 via nmap, but couldn't find the actual server files

- Realized DVWA might not be hosted on the VM I thought it was at all 🤯

Bottom line? The entire time, I was injecting into a DVWA instance that wasn't actually configured the way I thought it was. That’s why my results were skewed.

✅ Lesson locked in: Before troubleshooting your payloads, verify your lab state. Misconfigured environments are silent saboteurs — they make you doubt yourself, your tools, and your progress.
  
---

### 📌 Block 3: WHERE IS THIS APP EVEN HOSTED?!

### 🎯 Block 3 Goal

Investigate unexpected behavior in DVWA — namely, why the security level kept reverting to “high” even after explicitly changing it.

✅ Subtasks:

- [x] Check in Burp HTTP history to confirm the cookie shows `security=low`
- [x] Manually edit the cookie 
- [x] Try adjusting configs via /var/www/html/dvwa/config/config.inc.php (spoiler: led to "directory not found")
- [x] Try running netstat, nmap, and process checks to figure out what is hosting DVWA
- [x] Realize you might not be hosting DVWA on Metasploitable at all and think about crying a bit.
- [x] Call it a day and eat your feelings instead.

### 🧠 Block 3 Observations  

- Security level mismatch explains odd behavior in SQLi tests
- It’s possible the VM actually hosting DVWA is something else entirely (Kali? A different image?)
- Confirmed port 80 open on 192.168.77.20 but didn’t locate DVWA config files where expected

### 💡 Block 3 Takeaway

Misconfigurations are part of the red team journey — and hunting them down makes me better. This wasn’t a waste of time. It was a deep dive into environment validation, which is a foundational skill in both red and blue team ops.

### ✅ Next Steps for Day 6

- Confirm which VM is hosting DVWA using controlled startup and nmap + browser navigation
- Locate the real config.inc.php file and fix security level persistence
- Resume SQLi enumeration once you’re confident the playground is working as intended

